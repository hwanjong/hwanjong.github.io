---
title: "JPA vs Mybatis"
date: 2021-10-19 00:26:28 -0400
categories: backend
tags : spring java jpa
toc : true
---

# JPA (Java Persistence API)
## 1. JPA 란?
- JPA는 DB 작업을 객체 기반으로 다루는 ***인터페이스 표준*** 으로 관계형 데이터 베이스를 어떻게 사용해야하는지를 정의
    \- Hibernate : JPA를 준수하여 구현한 JPA 구현체 라이브러리 (*by Hibernate 개발자*)

    \- Spring Data JPA : Hibernate, JPA와 달리 Spring에서 제공하는 JPA 모듈이다.  
    > *API* : https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html  
    
    > *구현체* : https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/support/SimpleJpaRepository.html  

-  개념적으로 JPA는 JDBC와 Application 사이에 위치한다.  
  JDBC - ORM - **JPA** - Application  


## 2. JPA의 장점
***Hibernate가 JPA의 구현체***  
1) 객체 지향적 DB 접근  
2) 성능 최적화 기능  
    - 조회 시 캐싱 지원 (같은 트랙잭션 안에서)  
    - INSERT 버퍼링 기능 (같은 트랜잭션 안에서)  
    - 지연로딩, 즉시로딩 옵션화  
```java
    Member member = memberDAO.find(memberId);
    Team team = member.getTeam();

    team.getName(); //값이 필요한 시점에 한번만 SELECT 수행
```

## 3. JPA의 단점 - Mybatis와 비교
- SQL에 대한 모든 컨트롤을 하고자 할때 적절하지 않음.  
- SQL을 최적화해야할 때 적절하지 않음.


## 4. 결론
- JPA는 Mybatis에 비해 어렵지만 객체 지향적인 DB 작업가능.
- Hibernate 구현체가 아니더라도 Spring Data JPA 와 같은 인터페이스와 함께 별도 구현체를 더해서 사용도 가능.
- 대규모 시스템에서 데이터 엔지니어(또는 DA)와 협업이 필요할 경우 적합하지 않음  
    ex) Native 쿼리를 자주 사용해야하는 경우  
    ex) Hint index를 넣어야 하는 경우  
- SQL 의존도가 낮은 시스템에서 비교적 유용.  

----------------------


## 생각해볼 문제 (Study Item)
- JPA를 사용할 경우 복잡한 쿼리는(outer, multiple join) 어떻게 해결할지?  
    ☞ Join 할 Object를 지정해주는 방식. (N+1 문제 발생)  
    ```java
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "wedul_classes_id")
    @JsonBackReference
    private WedulClasses wedulClasses;
    ```
    ☞ native left fetch join, EntityGraph 이용 (비효율...)  
    **☞ QueryDSL이 SQL과 같은 쿼리를 인터페이스를 통해 사용할 수 있게 해준다.**  
    ```java
    public List<WedulClasses> findAllWithStudent() {
        QWedulClasses wedulClasses = QWedulClasses.wedulClasses;
        QWedulStudent wedulStudent = QWedulStudent.wedulStudent;
        return from(wedulClasses).leftJoin(wedulClasses.wedulStudentList, wedulStudent) .fetchJoin() .distinct() .fetch();
    }
    ```   
    > *참고 블로그 : https://wedul.site/638*

- 프로시저, Hint, Index 등을 쿼리에 강제로 넣어야하는 경우는 어떻게 해야하는가?  
    ☞ Native SQL query 필요
```java
return JPA.em().createNativeQuery(
    "select * from transaction with (INDEX(_dta_index_k1_1)) ...",
    Transaction.class).getResultList();
```
- JPA 라이브러리에서 Transaction 내부 실행 순서를 관리하는데, 의도하지 않은 문제나 성능 튜닝이 필요하지는 않을지?

- Spring Data JPA와 Hibernate 둘다 동일하게 where 조건을 함수명으로하여 자동으로 쿼리 생성하는지?
